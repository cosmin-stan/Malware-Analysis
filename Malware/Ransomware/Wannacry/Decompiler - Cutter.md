Analysis of the wannacry using a decompiler - <b>Cutter<b/>



Part of WannaCryâ€™s infection routine involves sending a  DNS request that checks for a live URL/domain. If its request returns showing that the URL is alive 
or online, it will activate the kill switch, prompting WannaCry to exit in the system and no longer proceed with its propagation and encryption routines. 
Thus, even if the infected machine restarts, the kill switch will prevent WannaCry from performing its routines on it.

Decompiler Graph of the Wannacry:

  ![image](https://user-images.githubusercontent.com/36852270/210055646-eacfcec1-093a-4089-9e50-d98c2678faf4.png)

  Notice from the Decompiler Graph the URL string containing the killswitch URL.
  
  It moves the string into the esi Register:
  
  ![image](https://user-images.githubusercontent.com/36852270/210056074-31e9fa34-9b2a-45c9-830d-91125ee8d2d9.png)

  It can also be noticed some important API calls:
  
![image](https://user-images.githubusercontent.com/36852270/210058778-36a81e87-2d0a-47b0-97a3-5bc8a16a2138.png)
  
![image](https://user-images.githubusercontent.com/36852270/210058791-2c8fb713-d434-42c1-9883-6bd3fc8d214d.png)
  
![image](https://user-images.githubusercontent.com/36852270/210058804-7c78358e-60f1-4a75-824e-4896fc999de1.png)

Everything is moved into edi Register where it performs a test, if it has a flag value of 0, it will continue executing the malware, if it has a flag value of 1, it will return and kill the process.
The flag value depends if the call to the killswitch domain succeds or not.
  
  ![image](https://user-images.githubusercontent.com/36852270/210057092-02542653-fa8c-476f-879c-05a024b040b7.png)
  
  
![image](https://user-images.githubusercontent.com/36852270/210057208-645917e0-dab9-4a44-8b41-52638dc8fc1f.png)

  For Flag 1, the malware manages to connect to the killswitch domain, the malware immediately exits.
  
  ![image](https://user-images.githubusercontent.com/36852270/210058356-3c10b3a7-2990-4310-9647-5bc787f8821a.png)

  For Flag 0, the malware doesn't succed into connecting to the killswitch Domain and it perform a call to another function:
  
  ![image](https://user-images.githubusercontent.com/36852270/210058377-c7c032a5-ed25-4e64-a979-27ca04ffb56d.png)
