
On the Dynamic Analysis part, I used <b>Procmon</b> to identify host indicators:


Procmon Filters:


![image](https://user-images.githubusercontent.com/36852270/210044133-d1a93a77-84b6-48dc-b6b4-ed5ad3e6ed51.png)

We executed our sample (Ransomware.wannacry.exe.malz) on the FLARE-VM

Startup

The malware starts by attempting to connect to the following domain with InternetOpenUrl:

    www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com

NOTE: If this succeeds, the malware immediately exits. .

If the connection fails, however, the malware checks the number of arguments passed to the program. If zero, the malware continues with installation; otherwise it enters service mode.

The malware continues by creating a service named mssecsvc2.0 with a binary path pointing to the running module with the arguments "-m security". Once created, the malware starts the service. The malware then locates its R resource and loads it into memory. The malware then writes the R resource data to the file C:\WINDOWS\tasksche.exe. The malware executes C:\WINDOWS\tasksche.exe /i with the CreateProcess API. The malware then attempts to move C:\WINDOWS\tasksche.exe to C:\WINDOWS\qeriuwjhrf, replacing the original file if it exists.

Source: https://www.mandiant.com/resources/blog/wannacry-malware-profile

![image](https://user-images.githubusercontent.com/36852270/210053674-1ced3148-2e11-4600-b703-e0bff253e141.png)









Wannacry Ransomware writes on the host an executable and it is used as a second-stage malware:

![image](https://user-images.githubusercontent.com/36852270/210044210-be73639f-51b4-41e7-8b59-4cf7a96d45c4.png)

---------------------------
Checksum information
---------------------------
Name: tasksche.exe
Size: 3514368 bytes (3 MB)

SHA256: ED01EBFBC9EB5BBEA545AF4D01BF5F1071661840480439C6E5BABE8E080E41AA

![image](https://user-images.githubusercontent.com/36852270/210044243-6406fafa-0348-463e-b282-963c5f954714.png)

The folder is located in the following folder

`C:\ProgramData\ytbjymfcjoghel136\tasksche.exe`

![image](https://user-images.githubusercontent.com/36852270/210044305-fe6d5664-3112-42b5-a27e-3bc16c2444b9.png)


Checking Services from Task Manager, I noticed that Wannacry establish its persistence by installing a service in case of restart.

![image](https://user-images.githubusercontent.com/36852270/210044418-766cd339-710b-498f-aa38-861d49b8955b.png)

We can also notice that Suspicious URL from the Floss output in the <b>Wireshark</b>:

![image](https://user-images.githubusercontent.com/36852270/210047137-2c5134b0-f111-4fb7-b0ad-ac8923b7bf7e.png)

Checking the <b>TCPView</b>

![image](https://user-images.githubusercontent.com/36852270/210047199-208d93ed-029f-4e29-937e-ca519a33fd5b.png)

The executable makes some TCP calls to an IP on port 445. (that IP from the image above it is not the actual malicious IP, it is generated automatically when the DHCP server is not reachable)

Wannacry takes advantance of the Eternal Blue exploit to spread throughout the network, it is still one of the most commonly attempted exploits against SMB, accounting for over 91.88% of the attacks on port 445 (the most common SMB port).


